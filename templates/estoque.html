<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock.Flow - Consulta</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- CSS com url_for -->
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='novo_produto.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='consulta_estoque.css') }}">
</head>

<body>

      <!-- Navbar inicio -->
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('home') }}"> Stock.Flow </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="{{ url_for('cadastro') }}">Cadastre-se</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('login') }}">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="">Home</a>
        </li>
      </ul>
      <span class="navbar-text">
        Organize seu estoque com facilidade!
      </span>
    </div>
  </div>
</nav>
<!-- Fim da navbar -->

    <div class="main-content align-items-start pt-5">
        <div class="container">

            <h2 class="titulo-pagina mb-4">Consulta de Estoque</h2>

            <!-- MUDANÇA 1: Barra de Pesquisa agora é um FORMulário -->
            <!-- method="GET" é padrão para buscas, pois coloca o termo na URL -->
            <div class="row mb-4 justify-content-center">
                <div class="col-md-8">
                    <form action="{{ url_for('consulta') }}" method="GET">
                        <div class="input-group">
                            <!-- name="q" é o nome que usaremos no Python para pegar o termo -->
                            <input type="text" name="q" class="form-control input-pesquisa" placeholder="Pesquisar por modelo..." value="{{ termo_pesquisa }}">
                            <!-- type="submit" para enviar o formulário -->
                            <button class="btn btn-roxo-pesquisa" type="submit">
                                <i class="bi bi-search" style="color: white;">Pesquisar</i> 
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tabela de Produtos -->
            <div class="tabela-container">
                <table class="table table-dark table-hover mb-0">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Time</th>
                            <th scope="col">Modelo</th>
                            <th scope="col">Ano</th>
                            <th scope="col">Tamanho</th>
                            <th scope="col">Qtd. Estoque</th>
                            <th scope="col" class="text-end">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- MUDANÇA 2: Loop Jinja2 para gerar linhas dinamicamente -->
                        {% for produto in lista_produtos %}
                        <tr>
                            <th scope="row">{{ loop.index }}</th> <!-- Contador automático 1, 2, 3... -->
                            <td>{{ produto.NomeTime }}</td> 

                            <td>{{ produto.Modelo }}</td>

                            <td>{{ produto.Ano }}</td>

                            <td>{{ produto.Tamanho }}</td>
                            
                            <td>
                                <!-- Lógica simples para mudar a cor se o estoque for baixo (opcional) -->
                                <span class="badge {{ 'bg-success' if produto.Quantidade > 5 else 'bg-danger' }}">
                                     {{ produto.Quantidade }} un
                                </span>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-light"><i class="bi bi-pencil"></i></button>
                                <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                            </td>
                        </tr>
                        {% else %}
                        <!-- Esse bloco aparece se a lista estiver vazia -->
                        <tr>
                            <td colspan="6" class="text-center">Nenhum produto encontrado.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>